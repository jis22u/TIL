## 개요

- 동기화란
- 공유 자원과 임계 구역 문제
- 임계 구역 문제를 해결하기 위한 동기화 기법

<br>

## 동기화란

### 동기화 왜 필요할까?

동시다발적으로 실행되는 많은 프로세스는 서로 데이터를 주고 받으며 협력하며 실행될 수 있다.  
협력적으로 실행되는 프로세스들은 아무렇게나 마구 동시에 실행해서는 안 된다.  
따라서 올바른 실행을 위해서는 동기화가 필수이다.  
💡 참고로 프로세스뿐만 아니라 스레드도 동기화의 대상이다.

```
예를 들어 워드 프로세서에는 사용자로부터 입력을 받는 프로세스와 입력한 내용의 맞춤법을 검사하는 프로세스,
입력한 내용을 화면에 출력해 주는 프로세스 등이 있다.
이 프로세스들은 각기 다른 독립적인 프로세스이지만 공동의 목표를 위해 서로 협력하는 존재이다.
```

<br>

### 동기화는 무엇을 의미?

'프로세스 동기화'란 프로세스들 사이의 수행 시기를 맞추는 것을 의미한다.

- 실행 순서 제어: 프로세스를 올바른 순서대로 실행하기 (실행 순서를 위한 동기화)
- 상호 배제: 동시에 접근해서는 안 되는 자원에 하나의 프로세스만 접근하게 하기 (상호 배제를 위한 동기화)

<br>

### 상호 배제를 위한 동기화를 자세히 살펴보자

```
👉 상호 배제를 위한 동기화의 예시
현재 계좌: 10만 원
프로세스 A: 현재 저축된 금액에 2만 원을 넣은 프로세스
프로세스 B: 현재 저축된 금액에 5만 원을 프로세스

A와 B는 '잔액'이라는 데이터를 동시에 사용하는데, A가 끝나기도 전에 B가 잔액을 읽어버리면 엉뚱한 결과 출력한다.
따라서 A와 B를 올바르게 실행하기 위해서는 한 프로세스가 '잔액'에 접근했을 때 다른 프로세스는 기다려야 한다.
여기서 '잔액'이 동시에 접근해서는 안 되는 자원인 것이다.
```

그렇다면 여기서 말하는 '동시에 접근해서는 안 되는 자원'이란 무엇일까?  
공유 자원과 임계 구역과 관련지어 살펴보자.

<br>

## 공유 자원과 임계 구역 문제

### 공유 자원이란

계좌 잔액 문제의 예시에서 동시에 실행되는 프로세스들은 전역 변수 '잔액'이라는 공동의 자원을 두고 작업을 한다.  
이러한 자원을 **공유 자원**이라고 한다.

공유 자원은 전역 변수가 될 수도 있고, 파일, 입출력장치, 보조기억장치가 될 수 있다.

<br>

### 임계 구역이란

공유 자원에 접근하는 코드 중 동시에 실행하면 문제가 발생하는 코드 영역을 **임계 구역**이라고 한다.

두 개 이상의 프로세스가 임계 구역에 진입하고자 하면 둘 중 하나는 대기해야 한다.  
임계 구역에 먼저 진입한 프로세스의 작업이 마무리되면 그제서야 비로소 기다렸던 프로세스가 임계 구역에 진입한다.  
<img src="https://github.com/jis22u/TIL/assets/110139421/c0efbb6c-1cd2-4fc0-bb47-a349073f5109" width="800" height="300"/>

<br>

### 레이스 컨디션?

임계 구역은 두 개 이상의 프로세스가 동시에 실행되면 안 되는 영역이지만,  
잘못된 실행으로 인해 여러 프로세스가 동시 다발적으로 임계 구역의 코드를 실행하여 문제가 발생하는 경우

레이스 컨디션이 발생하면 계좌 잔액 문제처럼 데이터의 일관성이 깨지는 문제가 발생한다.

<br>

### 레이스 컨디션의 근본적인 이유?

코드는 고급 언어 한 줄로 작성할 수 있지만, 이는 컴퓨터 내부에서 여러 줄의 저급 언어로 변환되어 실행된다.
여러 줄의 저급 언어로 변환된 고급 언어 한 줄을 실행하는 과정에서 문맥 교환이 일어날 수 있다.  
즉, 저급 언어를 실행하는 과정에서 문맥 교환이 일어난다면 아래와 같이 문제가 발생한다.

<img src="https://github.com/jis22u/TIL/assets/110139421/b4447d81-d9ff-4f45-8cb5-d20fe56be813" width="800" height="300"/>

<br>

### 운영체제가 이러한 임계 구역 문제를 해결하는 세 가지 원칙

즉, 상호 배제를 위한 동기화를 위한 세 가지 원칙

- 상호 배제
- 진행
- 유한 대기

<br>

## 동기화 기법

_[상호 배제를 위한 동기화 기법]_

### 뮤텍스 락

- 동시에 접근해서는 안 되는 자원에 동시에 접근하지 않도록 만드는 도구  
  상호 배제를 위한 동기화 도구
- 임계 구역에 진입하는 프로세스는 '내가 지금 임계 구역에 있음'을 알리기 위해 뮤텍스 락을 이용해  
  임계 구역에 자물쇠를 걸어둘 수 있고, 다른 프로세스는 임계 구역이 잠겨 있다면 기다리고,  
  잠겨 있지 않다면 임계 구역에 진입할 수 있다.
- 임계 구역이 잠겨 있는지 쉴 새 없이 반복하여 확인해 보는데, 이런 대기 방식을 바쁜 대기라고 한다.
- 하나의 공유 자원에 접근하는 프로세스를 상정한 방식

```
- 자물쇠 역할: 프로세스들이 공유하는 전역 변수 lock
- 임계 구역을 잠그는 역할: acquire 함수
- 임계 구역의 잠금을 해제하는 역할: release 함수
```

<br>

### 세마포

- 공유 자원이 여러 개 있을 경우 (각 공유 자원에는 하나의 프로세스만 진입이 가능할지라도)  
  여러 개의 프로세스가 각각 공유 자원에 접근하는 프로세스를 상정한 방식
- 사용할 수 있는 공유 자원이 없는 경우 프로세스는 무작정 무한히 반복하며 S를 확인해야 한다.  
  이런 바쁜 대기를 반복하여 확인할 시간에 CPU는 더 생산성 있는 작업을 할 수 있을 덴데, CPU 주기를 낭비한다는 점에서 손해이다.
  (뮤텍스 락도 해당)
- 이러한 문제점을 고려하여 대기 상태인 프로세스의 PCB를 관리하는 세마포를 위한 대기 큐를 활용한다.

```
- 임계 구역에 진입할 수 있는 프로세스의 개수 (사용 가능한 공유 자원의 개수)를 나타내는 전역 변수 S
- 임계 구역에 들어가도 좋은지, 기다려야 할지를 알려주는 wait 함수
- 임계 구역 앞에서 기다리는 프로세스에 '이제 가도 좋다'고 신호를 주는 signal 함수
```

<img src="https://github.com/jis22u/TIL/assets/110139421/34f949d2-2f32-4a9f-9665-7ffb8e95c0c2" width="500" height="350"/>
 
<br>

_[실행 순서 제어를 위한 동기화 기법]_

세마포의 변수 S를 0으로 두고 먼저 실행할 프로세스 뒤에 signal 함수, 다음에 실행할 프로세스 앞에 wait 함수를 붙이면 된다.

<br>

_[두 가지 모두 제어하는 동기화 기법]_

### 모니터

- 공유 자원과 공유 자원에 접근하기 위한 인터페이스(통로)를 묶어 관리한다.
- 프로세스는 반드시 인터페이스를 통해서만 공유 자원에 접근하도록 한다.
- 모니터는 공유 자원을 다루는 인터페이스에 접근하기 위한 큐(모니터에 진입하기 위한 큐)를 만들고,  
  모니터 안에 항상 하나의 프로세스만 들어오도록 하여 상호 배제를 위한 동기화를 제공
- 특정 조건을 바탕으로 프로세스를 실행하고 일시 중단하기 위해 모니터는 조건 변수를 사용하는데,  
  조건 변수는 프로세스나 스레드의 실행 순서를 제어하기 위해 사용하는 특별한 변수이다.  
  💡 모니터와 조건 변수는 별개의 개념이다. 모니터가 조건 변수를 활용할 뿐
